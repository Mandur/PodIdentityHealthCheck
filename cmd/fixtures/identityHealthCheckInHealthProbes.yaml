apiVersion: v1
kind: Pod
metadata:
  name: podidentity-test-pod
  labels:
    aadpodidbinding: podidentity
spec:
  containers:
  - name: main
    image: busybox
    command: [ "sh", "-c", "--" ]
    args: [ "while true; do sleep 30; done;" ]
    readinessProbe:
      exec:
        command:
        - sh
        - -c
        - curl 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https%3A%2F%2Fmanagement.azure.com%2F' -H Metadata:true -s
      initialDelaySeconds: 0
      periodSeconds: 5
      failureThreshold: 1
    livenessProbe:
      exec:
        command:
        - sh
        - -c
        - curl 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https%3A%2F%2Fmanagement.azure.com%2F' -H Metadata:true -s
      initialDelaySeconds: 30
      periodSeconds: 5
      failureThreshold: 3